<!DOCTYPE html>
<!-- Copyright (C) 2016 by Jeremy Spiller, all rights reserved. -->
<html>
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <script type="text/javascript" src="Sha256.js"></script>
    <script type="text/javascript" src="Viewtop.js"></script>
    <style>

body { background: lavender;}

h1 { color: darkblue;}

.button 
{
  font: 13px Arial;
  text-decoration:none;
  background: #E1E1E1;
  background:linear-gradient(#f6f6f6,#dedede);
  color: #000000;
  padding: 2px 6px 3px 6px;
  margin-bottom: 4px;
  border: 1px solid #ADADAD;
}

.button:hover
{
  background: #E5F1FB;
  background:linear-gradient(#E5F1FB,#E5F1FB);
  border: 1px solid #0078D7;
}

/* Remove extra button padding in Firefox */
button::-moz-focus-inner 
{
    border:0;
    padding:0;
    margin-top:-1px; 
	margin-bottom: 0;
}


    </style>
</head>
<body>
    <!-- Login form -->
    <div id="remoteLoginPageId">
        <h1>Welcome to Open Viewtop</h1>
        <h3>Log in to ComputerName</h3>
        <div style="display:inline-block;margin-right:10px;">
            <div><b>Username: </b></div>
            <input id="usernameId" type="text" placeholder="Enter Username" name="uname" autofocus
                   onkeypress="Javascript: if (event.keyCode == 13) document.getElementById('passwordId').focus();">
        </div>
        <div style="display:inline-block;margin-right:10px;">
            <div><b>Password: </b></div>
            <input id="passwordId" type="password" placeholder="Enter Password" name="password"
                   onkeypress="Javascript: if (event.keyCode == 13) Login();">            
        </div>
        <div style="display:inline-block">
            <button class="button" type="button" onclick="Login()">Log In</button>
        </div>
        <div id="errorMessageId" style="display:none;">
            Message
        </div>
        <div id="unsecureWarningId" style="display:none;">
            <b style="color:red;">Warning:</b> This connection is running over HTTP and is unsecure
        </div>
        <div>
            <label><input type="checkbox" id="useWebsocketsId">Use Websockets.  It doesn't work yet.</label>
        </div>
    </div>

    <div id="remoteConnectedPageId" style="display:none" >
        
        <!-- Top connected bar -->
        <div style="margin: 0px 0px 2px 0px;">
            <button class="button" type="button" onclick="Logout()">Log Out</button>
            <button class="button" type="button" onclick="FullScreen()" title="Full Screen">[ ]</button>
            <a class="button" id="clipboardId">Clipboard</a>
            <b id="computerNameId" style="float:right;margin-right:4px;">(unknown)</b>
        </div>

        <!-- Main Screen-->
        <canvas id="remoteCanvasId" tabindex="1">
        Canvas not available.  Please upgrade your browser.
        </canvas>

        <!-- Stats and options -->
        <table id="remoteOptionsId" style="display:block">
            <tr>
                <td>
                    <label><input type="checkbox" id="checkFullFrame" onchange="UpdateOptions()">Full frame analysis (disable delta)</label>
                    <br /> <br />
                    <label><input type="radio" name="compression" id="radioSmartPng" checked="checked" onchange="UpdateOptions()">Smart PNG</label>
                    <br />
                    <label><input type="radio" name="compression" id="radioJpg" onchange="UpdateOptions()">Compress JPG</label>
                    <br />
                    <label><input type="radio" name="compression" id="radioPng" onchange="UpdateOptions()">Compress PNG</label>
                    <br />
                </td>
                <td>
                    <label><input type="radio" name="output" id="radioNormal" checked="checked" onchange="UpdateOptions()">Normal</label>
                    <br />
                    <label><input type="radio" name="output" id="radioFullFrameJpg" onchange="UpdateOptions()">Full frame JPG</label>
                    <br />
                    <label><input type="radio" name="output" id="radioFullFramePng" onchange="UpdateOptions()">Full frame PNG</label>
                    <br />
                    <label><input type="radio" name="output" id="radioCompressionMap" onchange="UpdateOptions()">Compression map</label>
                    <br />
                    <label><input type="radio" name="output" id="radioHideJpg" onchange="UpdateOptions()">Hide JPG</label>
                    <br />
                    <label><input type="radio" name="output" id="radioHidePng" onchange="UpdateOptions()">Hide PNG</label>
                    <br />
                </td>
                <td>
                    <p id="remoteStatsId">Draw string</p>
                </td>
            </tr>
        </table>
    </div>
</body>
</html>

<script>

    var mViewer = null;
    var mRemoteLoginPage = document.getElementById('remoteLoginPageId');
    var mRemoteConnectedPage = document.getElementById('remoteConnectedPageId');
    var mRemoteCanvas = document.getElementById('remoteCanvasId');
    var mRemoteOptions = document.getElementById('remoteOptionsId');
    var mRemoteStats = document.getElementById('remoteStatsId');
    var mUsername = document.getElementById('usernameId');
    var mPassword = document.getElementById('passwordId');
    var mUseWebsockets = document.getElementById('useWebsocketsId');
    var mErrorMessage = document.getElementById('errorMessageId');
    
    document.getElementById('unsecureWarningId').style.display = location.protocol === "https:" ? "none" : "block";

    // Called when the user clicks the login button
    function Login()
    {
        Logout();

        mRemoteLoginPage.style.display = "none";
        mRemoteConnectedPage.style.display = "block";

        mViewer = new Viewtop(mRemoteStats, mRemoteCanvas);
        mViewer.ErrorCallback = function(errorMessage)
        {
            Logout();
            mErrorMessage.innerHTML = "<b>ERROR:</b> " + errorMessage;
            mErrorMessage.style.display = "block";
        }
        mViewer.ClipboardButton = document.getElementById('clipboardId');
        mViewer.ComputerNameLabel = document.getElementById('computerNameId');
        UpdateOptions();
        mViewer.Start(mUsername.value, mPassword.value, !mUseWebsockets.checked);
    }

    function Logout()
    {
        if (mViewer != null)
            mViewer.Stop();
        mViewer = null;
        mRemoteLoginPage.style.display = "block";
        mRemoteConnectedPage.style.display = "none";
        mErrorMessage.style.display = "none";
        mUsername.focus();
    }

    function FullScreen()
    {
        if (mRemoteCanvas.requestFullscreen)
            mRemoteCanvas.requestFullscreen();
        else if (mRemoteCanvas.webkitRequestFullScreen)
            mRemoteCanvas.webkitRequestFullScreen();
        else if (mRemoteCanvas.mozRequestFullScreen)
            mRemoteCanvas.mozRequestFullScreen();
    }


    function UpdateOptions()
    {
        // Check boxes
        var options = "&";
        if (document.getElementById('checkFullFrame').checked)
            options += "fullframe=true&";

        // Compression type radio buttons
        if (document.getElementById('radioJpg').checked)
            options += "compression=jpg&";
        else if (document.getElementById('radioPng').checked)
            options += "compression=png&";
        else if (document.getElementById('radioSmartPng').checked)
            options += "compression=smartpng&";

        // Output type radio button
        if (document.getElementById('radioFullFrameJpg').checked)
            options += "output=FullFrameJpg&";
        else if (document.getElementById('radioFullFramePng').checked)
            options += "output=FullFramePng&";
        else if (document.getElementById('radioCompressionMap').checked)
            options += "output=CompressionMap&";
        else if (document.getElementById('radioHideJpg').checked)
            options += "output=HideJpg&";
        else if (document.getElementById('radioHidePng').checked)
            options += "output=HidePng&";

        mViewer.DrawOptions = options;
        console.log("Options=" + options);
    }

</script>

